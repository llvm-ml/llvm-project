//===- Transforms/Instrumentation/InstrumentorConfig.def ------------------===//
//
// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.
// See https://llvm.org/LICENSE.txt for license information.
// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
//
//===----------------------------------------------------------------------===//
//
//===----------------------------------------------------------------------===//

// No include guards

/// Base configuration
///{
SECTION_START(Base, )

/// The base name which defines the runtime call names, i.a.,
/// <BaseName><instruction/location>(...)
CONFIG(Base, std::string, RuntimeName, "__instrumentor_")

/// Print the signatures of all used runtime functions.
CONFIG(Base, bool, PrintRuntimeSignatures, true)

SECTION_END(Base)
///}

/// AllocaInst
///{
SECTION_START(Alloca, AllocaInst)

/// Should allocas be instrumented.
CONFIG(Alloca, bool, Instrument, true)

/// Selection of information passed to the runtime.
///{
/// The actual allocated pointer.
CONFIG(Alloca, bool, Value, true)
/// The size of the entire allocation.
CONFIG(Alloca, bool, AllocationSize, true)
/// The minimal alignment requested statically.
CONFIG(Alloca, bool, Alignment, true)
///}

/// Should the value be replaced by the runtime call result.
CONFIG(Alloca, bool, ReplaceValue, true)

/// Optional callback, see CallbackTy.
CONFIG_INTERNAL(Alloca, CallbackTy, CB, nullptr)

SECTION_END(Alloca)
///}

/// StoreInst
///{
SECTION_START(Store, StoreInst)

/// Should stores be instrumented.
CONFIG(Store, bool, Instrument, true)

/// Selection of information passed to the runtime.
///{
/// The pointer operand.
CONFIG(Store, bool, PointerOperand, true)
/// The pointer operand address space.
CONFIG(Store, bool, PointerOperandAddressSpace, true)
/// The value operand, passed as 64-bit integer.
CONFIG(Store, bool, ValueOperand, true)
/// The value operand size.
CONFIG(Store, bool, ValueOperandSize, true)
/// The value operand type id.
CONFIG(Store, bool, ValueOperandTypeId, true)
/// The minimal alignment requested statically.
CONFIG(Store, bool, Alignment, true)
/// The atomicity ordering.
CONFIG(Store, bool, AtomicityOrdering, true)
/// The sync cope id.
CONFIG(Store, bool, SyncScopeId, true)
/// The volatile flag.
CONFIG(Store, bool, IsVolatile, true)
/// The pointer base info. See BasePointer.
CONFIG(Store, bool, BasePointerInfo, true)
///}

/// Should the pointer operand be replaced by the runtime call result.
CONFIG(Store, bool, ReplacePointerOperand, true)

/// Skip instrumenting stores that are known to be safe at compile time.
CONFIG(Store, bool, SkipSafeAccess, false)

/// Optional callback, see CallbackTy.
CONFIG_INTERNAL(Store, CallbackTy, CB, nullptr)

SECTION_END(Store)
///}

/// LoadInst
///{
SECTION_START(Load, LoadInst)

/// Should loads be instrumented before their execution.
CONFIG(Load, bool, InstrumentBefore, true)

/// Should loads be instrumented after their execution.
CONFIG(Load, bool, InstrumentAfter, true)

/// Selection of information passed to the runtime.
///{
/// The pointer operand.
CONFIG(Load, bool, PointerOperand, true)
/// The pointer operand address space.
CONFIG(Load, bool, PointerOperandAddressSpace, true)
/// The loaded value, passed as 64-bit integer.
CONFIG(Load, bool, Value, true)
/// The value size.
CONFIG(Load, bool, ValueSize, true)
/// The value type id.
CONFIG(Load, bool, ValueTypeId, true)
/// The minimal alignment requested statically.
CONFIG(Load, bool, Alignment, true)
/// The atomicity ordering.
CONFIG(Load, bool, AtomicityOrdering, true)
/// The sync cope id.
CONFIG(Load, bool, SyncScopeId, true)
/// The volatile flag.
CONFIG(Load, bool, IsVolatile, true)
/// The pointer base info. See BasePointer.
CONFIG(Load, bool, BasePointerInfo, true)
///}

/// Should the pointer operand be replaced by the runtime call result.
CONFIG(Load, bool, ReplacePointerOperand, true)

/// Should the value be replaced by the runtime call result.
CONFIG(Load, bool, ReplaceValue, true)

/// Skip instrumenting loads that are known to be safe at compile time.
CONFIG(Store, bool, SkipSafeAccess, false)

/// Optional callback, see CallbackTy.
CONFIG_INTERNAL(Load, CallbackTy, CB, nullptr)

SECTION_END(Load)
///}

/// AllocationCall
///{
SECTION_START(AllocationCall, CallBase)

/// Should allocation calls, i.a., malloc, new, be instrumented.
CONFIG(AllocationCall, bool, Instrument, true)

/// Selection of information passed to the runtime.
///{
/// The allocation result, passed as void *.
CONFIG(AllocationCall, bool, MemoryPointer, true)
/// The allocation memory size.
CONFIG(AllocationCall, bool, MemorySize, true)
/// The minimal alignment requested statically.
CONFIG(AllocationCall, bool, Alignment, true)
/// The allocation family, passed as a C string.
CONFIG(AllocationCall, bool, Family, true)
/// The initial allocation value: 0 for zeros, 1, for undef, or -1 if unknown.
CONFIG(AllocationCall, bool, InitialValue, true)
///}

/// Should the value be replaced by the runtime call result.
CONFIG(AllocationCall, bool, ReplaceValue, true)

/// Optional callback, see CallbackTy.
CONFIG_INTERNAL(AllocationCall, CallbackTy, CB, nullptr)

SECTION_END(AllocationCall)
///}

/// MemoryIntrinsic
///{
SECTION_START(MemoryIntrinsic, CallBase)

/// Should memory intrinsics, e.g., memset, memcpy, be instrumented.
CONFIG(MemoryIntrinsic, bool, Instrument, true)

/// Selection of information passed to the runtime.
///{
/// The kind identifier (memset, memset_inline, ...)
CONFIG(MemoryIntrinsic, bool, KindId, true)
/// The destination pointer.
CONFIG(MemoryIntrinsic, bool, DestinationPointer, true)
/// The destination pointer address space.
CONFIG(MemoryIntrinsic, bool, DestinationPointerAddressSpace, true)
/// The source pointer.
CONFIG(MemoryIntrinsic, bool, SourcePointer, true)
/// The source pointer address space.
CONFIG(MemoryIntrinsic, bool, SourcePointerAddressSpace, true)
/// The memset value (2x i64).
CONFIG(MemoryIntrinsic, bool, MemsetValue, true)
/// The length of the operation in bytes.
CONFIG(MemoryIntrinsic, bool, Length, true)
/// The volatile flag.
CONFIG(MemoryIntrinsic, bool, IsVolatile, true)
/// The atomic element size.
CONFIG(MemoryIntrinsic, bool, AtomicElementSize, true)
///}

/// Should the value be replaced by the runtime call result.
CONFIG(MemoryIntrinsic, bool, ReplaceValue, true)

/// Optional callback, see CallbackTy.
CONFIG_INTERNAL(MemoryIntrinsic, CallbackTy, CB, nullptr)

SECTION_END(MemoryIntrinsic)
///}

/// GeneralIntrinsic
///{
SECTION_START(GeneralIntrinsic, CallBase)

/// Should general intrinsics, e.g., traps, be instrumented.
CONFIG(GeneralIntrinsic, bool, Instrument, true)

/// Selection of information passed to the runtime.
///{
/// The kind identifier (trap, ...)
CONFIG(GeneralIntrinsic, bool, KindId, true)
///}

/// Optional callback, see CallbackTy.
CONFIG_INTERNAL(GeneralIntrinsic, CallbackTy, CB, nullptr)

SECTION_END(GeneralIntrinsic)
///}

/// Unreachable
///{
SECTION_START(Unreachable, UnreachableInst)

/// Should unreachables be instrumented.
CONFIG(Unreachable, bool, Instrument, true)

/// Optional callback, see CallbackTy.
CONFIG_INTERNAL(Unreachable, CallbackTy, CB, nullptr)

SECTION_END(Unreachable)
///}

/// GlobalVariable
///{
SECTION_START(GlobalVariable, GlobalVariable)

/// Should the global variables be instrumented.
CONFIG(GlobalVariable, bool, Instrument, true)

/// Selection of information passed to the runtime.
///{
/// The pointer to the global variable.
CONFIG(GlobalVariable, bool, Value, true)
/// The size of the global variable.
CONFIG(GlobalVariable, bool, Size, true)
/// The minimal alignment requested statically.
CONFIG(GlobalVariable, bool, Alignment, true)
/// Whether the global variable is constant.
CONFIG(GlobalVariable, bool, Constant, true)
/// The value of the unnamed address attribute.
CONFIG(GlobalVariable, bool, UnnamedAddress, true)
/// The name of the global variable.
CONFIG(GlobalVariable, bool, Name, true)
///}

/// Should the value be replaced by the runtime call result.
CONFIG(GlobalVariable, bool, ReplaceValue, true)

/// Optional callback, see GlobalCallbackTy.
CONFIG_INTERNAL(GlobalVariable, GlobalCallbackTy, CB, nullptr)

SECTION_END(GlobalVariable)
///}

/// Module
///{
SECTION_START(Module, Module)

/// Should the module construction be instrumented.
CONFIG(Module, bool, InstrumentBefore, true)

/// Should the module destruction be instrumented.
CONFIG(Module, bool, InstrumentAfter, true)

/// Selection of information passed to the runtime.
///{
/// The name of the module.
CONFIG(Module, bool, Name, true)
/// The target triple of the module.
CONFIG(Module, bool, TargetTriple, true)
///}

SECTION_END(Module)
///}

/// MainFunction
///{
SECTION_START(MainFunction, CallBase)

/// Should the main function be instrumented before its execution.
CONFIG(MainFunction, bool, InstrumentBefore, true)

/// Should the main function be instrumented after its execution.
CONFIG(MainFunction, bool, InstrumentAfter, true)

/// Selection of information passed to the runtime.
///{
/// The pointers to the main arguments.
CONFIG(MainFunction, bool, Args, true)
/// The value returned by the main function.
CONFIG(MainFunction, bool, Value, true)
/// Should the value be replaced by the runtime call result.
CONFIG(MainFunction, bool, ReplaceValue, true)
///}

/// Optional callback, see GlobalCallbackTy.
CONFIG_INTERNAL(MainFunction, GlobalCallbackTy, CB, nullptr)

SECTION_END(MainFunction)
///}

/// CallArg
///{
SECTION_START(CallArg, Value)

/// Should the arguments of function calls be instrumented.
CONFIG(CallArg, bool, Instrument, true)

/// Selection of information passed to the runtime.
///{
/// The argument value.
CONFIG(CallArg, bool, Value, true)
/// Should the value be replaced by the runtime call result.
CONFIG(CallArg, bool, ReplaceValue, true)
///}

SECTION_END(CallArg)
///}

/// BasePointer
///{
SECTION_START(BasePointer, Value)

/// Should the base pointers (originators) be instrumented.
CONFIG(BasePointer, bool, Instrument, true)

/// Selection of information passed to the runtime.
///{
/// The base pointer.
CONFIG(BasePointer, bool, Value, true)
/// Should the runtime call return pointer information as a 64-bit integer. This
/// info can be forwarded to load and store instrumentation. See BasePointerInfo
/// option for Load and Store.
CONFIG(BasePointer, bool, ReturnPointerInfo, true)
///}

/// Skip instrumenting base pointers whose PointerInfo are not used by any Load
/// or Store.
CONFIG(BasePointer, bool, SkipUnused, true)

SECTION_END(BasePointer)
///}

#undef SECTION_START
#undef CONFIG
#undef CONFIG_INTERNAL
#undef SECTION_END
